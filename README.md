# simple-db

[Database Design and Implementation](https://link.springer.com/book/10.1007/978-3-030-33836-7) を読みながら DB の実装をする

# 本のまとめ

## 第１章 Database System

### データベースの 5 つの基本機能
* 永続的でなければならない
* 共有できること
* 正確に保たれること
* 非常に大きくなること
* 使いやすいこと

### データベースの機能まとめ
* ファイルシステムでただ保存するよりも効率的にアクセスできる形式を使用して、ファイルにレコードを保存する機能
* ファイル内のデータにインデックスを付けるためのアルゴリズムを使用することで、高速なアクセスを可能にする機能
* ネットワーク経由で複数のユーザーからの同時アクセスを処理し、必要に応じて排他制御を行う機能
* 変更のコミットやロールバックを実施する機能
* データベースのレコードをインメモリにキャッシュしながらも、システムがクラッシュした際にデータを失わない機能
* テーブルに対するユーザークエリをファイル上の実行可能なコードに変換する機能
* 非効率なクエリを効率的なクエリに変換するための最適化機能

参考文献
https://en.wikipedia.org/wiki/Database#History

## 第2章 JDBC

### JDBCの基本機能は以下の5つのインターフェースにより実装されている
* Driver・・クライアントがDBに接続するためのもの
* Connection・・クライアントがURLとプロパティを用いて実際にDBに接続するときのもの
* Statement・・SQLクエリを実行するためのもの
* ResultSet・・SQLクエリの結果を返すもの。ResultSetはリソースを拘束する事になるのでクローズをして解放する必要がある。
* ResultSetMetadata・・各フィールドの名前、タイプ、表示サイズを定義しており、このインターフェースを通じて利用可能

#### java の try-with-resources

tryブロックが終了した時に自動的にクローズする
```java
try (Connection conn = d.connect(url, null)) {  
  System.out.println("Database Created");  
} catch (SQLException e) {
  e.printStackTrace();  
}
```

#### DriverManager
DriverManagerを使用することでドライバをクライアントから隠蔽することが出来る。
ドライバをコレクションに追加しておき、必要な時に接続文字列を渡すことでドライバを取得できる。
JDBCではドライバ情報をJavaの設定ファイルに記述することで、クライアントコードからドライバ情報をなくすことが出来る。

#### DataSource
DataSourceを使用することで、ドライバと接続文字列をクライアントから隠蔽することが出来る。
各データベースベンダーが用意しているDataSourceを実装したクラスを使用することで、クライアントは必要な値を指定するだけでDBに接続できる。

### 4つのトランザクション分離レベル
* Read-Uncommitted・・トランザクションが全く分離されておらず、他のトランザクションで更新されたデータが見える。
* Read-Committed・・トランザクションがコミットされていない値にアクセスすることを禁止する。繰り返されない読み取りやファントムに関する問題は依然として起こる。
* Repeatable-Read・・Read-Committedを拡張し、一度読み取りを行うと常に同じ結果が繰り返されるようになる。ただし、ファントムの問題は残る。(mysqlではMVCCによりファントムの問題を防いでいる)
* Serializable・・トランザクションを順序付けて処理する。データを安全に操作できるが並列性が失われる。

#### クライアント vs SQL
ほとんどの場合、クライアント側でコードを書くよりSQLクエリで表現してDBに計算させる方が見た目もよく効率がいい。



